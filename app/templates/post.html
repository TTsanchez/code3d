{% extends 'base2.html' %}

{% block title %}
{{post.title}} | {{user.username}} | Code3d.ru
{% endblock %}

{% block body %}

{% set user_liked = false %}
{% if current_user.is_authenticated %}
{% set user_liked = post.likes | selectattr("user_id", "equalto", current_user.user_id) | list | length > 0 %}
{% endif %}

<center>
    <!--        <h1>{{post.type_of_work}}</h1>-->
    <!--        <h2>{{post.title}}</h2>-->
    <!--        <h3>–°—Ç—É–¥–µ–Ω—Ç –≥—Ä. {{user.group or 'N/A'}} - {{user.last_name}} {{user.first_name[0]}}.{{user.father_name[0]}}.</h3>-->
    {% if post.technology3d == 'x3dom' %}
    <div class="threejs-header">
        <h1>{{post.title}}</h1>
        <h2>{{user.username}}</h2>
    </div>

    <div class="x3dom-container">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="preview-section">
            <x3d id="x3d-container" width="100%" height="70vh">
                {{post.code3d|safe}}
            </x3d>

            <div class="post-actions">
                <button class="like-btn {% if user_liked %}liked{% endif %}"
                        data-post-id="{{ post.post_id }}"
                        onclick="likePost('{{ post.post_id }}')">
                    ‚ù§Ô∏è {{ post.likes|length }}
                </button>
                <button class="share-btn">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                <button class="comments-btn" onclick="toggleComments()">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</button>
            </div>

            <div class="comments-section" id="comments-section">
                <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="code-section">
            <textarea id="x3d-editor">{{post.code3d}}</textarea>

            <div class="controls">
                <button id="x3d-run-button">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ü–µ–Ω—É</button>
                <div id="x3d-output"></div>
            </div>
        </div>
    </div>

    <div class="post-description">
        <h3>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h3>
        <p>{{post.description}}</p>
    </div>

    {% elif post.technology3d == 'verge3d' %}
    <div class="verge3d-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∞–≤—Ç–æ—Ä -->
        <div class="threejs-header">
            <h1>{{ post.title }}</h1>
            <h2>{{ user.username }}</h2>
        </div>

        <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä 3D-—Å—Ü–µ–Ω—ã -->
        <div class="preview-section-verge">
            <iframe id="Okno" allowfullscreen src="{{ post.code3d|safe }}" width="100%" height="600vh"
                    style="border: none;"></iframe>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="post-actions">
                <button class="like-btn {% if user_liked %}liked{% endif %}"
                        data-post-id="{{ post.post_id }}"
                        onclick="likePost('{{ post.post_id }}')">
                    ‚ù§Ô∏è {{ post.likes|length }}
                </button>

                <button class="share-btn">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                <button class="comments-btn" onclick="toggleComments()">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</button>
            </div>

            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
            <div class="comments-section" id="comments-section">
                <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
            </div>
        </div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ -->
        <div class="post-description">
            <h3>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h3>
            <p>{{ post.description }}</p>
        </div>
    </div>

    {% elif post.technology3d == 'three.js' %}
    <div class="threejs-header">
        <h1>{{post.title}}</h1>
        <h2>{{user.username}}</h2>
    </div>

    <div class="threejs-container">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="preview-section">
            <div id="canvas-container"></div>

            <div class="post-actions">
                <button class="like-btn {% if user_liked %}liked{% endif %}"
                        data-post-id="{{ post.post_id }}"
                        onclick="likePost('{{ post.post_id }}')">
                    ‚ù§Ô∏è {{ post.likes|length }}
                </button>
                <button class="share-btn">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                <button class="comments-btn" onclick="toggleComments()">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</button>
            </div>

            <div class="comments-section" id="comments-section">
                <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="code-section">
            <textarea id="3js-editor">{{post.code3d}}</textarea>

            <div class="controls">
                <button id="3js-run-button">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥</button>
                <div id="3js-output"></div>
            </div>
        </div>
    </div>

    <div class="post-description">
        <h3>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h3>
        <p>{{post.description}}</p>
    </div>
    {% endif %}

</center>
<div>
    <pre id="content">{{post.content}}</pre>
</div>


<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ jQuery  -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/post_style.css') }}">
<!-- CodeMirror CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.min.css">
<!-- CodeMirror JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>

<script src="../static/js/toggleComments.js"></script>
<script src="{{ url_for('static', filename='js/copy_post.js') }}"></script>
<script src="{{ url_for('static', filename='js/show_flash_message.js') }}"></script>
<script src="../static/js/likePost.js"></script>

{% if post.technology3d == 'x3dom' %}
<!-- X3DOM -->
<link rel="stylesheet" href="https://www.x3dom.org/download/x3dom.css">
<script src="https://www.x3dom.org/download/x3dom.js"></script>
<script src="https://www.x3dom.org/download/dev/x3dom-full.js"></script>
<script src="../static/js/x3d_run_code.js"></script>
{% elif post.technology3d == 'three.js' %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="../static/js/3js_run_code.js"></script>
{% endif %}
{% endblock %}